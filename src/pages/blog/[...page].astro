---
import Blog from "@/layouts/Blog.astro";
import fetchApi from "@/lib/strapi";
import "@/styles/globals.css";
import type { IArticle } from "@/types/article";
import type { GetStaticPathsOptions } from "astro";
import QueryString from "qs";

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
	const articles = await fetchApi<IArticle[]>({
		endpoint: "articles",
		wrappedByKey: "data",
		query: QueryString.stringify(
			{
				populate: ["categories"],
				pagination: {
					limit: 100,
				},
			},
			{
				encodeValuesOnly: true,
			}
		),
	});

	return paginate(articles, {
		pageSize: 9,
	});
}

const { page } = Astro.props;
---

<Blog
	previousUrl={page.url.prev}
	nextUrl={page.url.next}
	currentPage={page.currentPage}
	articles={page.data}
/>
